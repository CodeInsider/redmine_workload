<h2><%= l(:workload_show_label) %></h2>
  <%= render :partial => 'filters' %>

<%= error_messages_for 'query' %>
<%
  timeSpanToDisplay = @first_day..@last_day

  monthsToRender = ListUser::getMonthsInTimespan(timeSpanToDisplay)
  workloadData   = ListUser::getHoursPerUserIssueAndDay(@usersToDisplay, timeSpanToDisplay, Date::today)

  totalWorkloadPerUser = ListUser::calculateTotalUserWorkloads(workloadData, timeSpanToDisplay)

%>
<div class="wrapper">
  <table class="data">
    <thead>
      <tr class="month-names">
        <td class="logo" rowspan="3">&nbsp;<!--Contains logo or empty space --></td>
        <% monthsToRender.each do |someDayOfMonth| %>
          <%= render :partial => 'month_names_header', :locals => {:dayOfMonth => someDayOfMonth} %>
        <% end %>
      </tr>
      <tr class="days-of-month">
        <% monthsToRender.each do |someDayOfMonth| %>
          <%= render :partial => 'day_of_month_header', :locals => {:dayOfMonth => someDayOfMonth} %>
        <% end %>
      </tr>
      <tr class="days-of-week">
        <% monthsToRender.each do |someDayOfMonth| %>
          <%= render :partial => 'day_of_week_header', :locals => {:dayOfMonth => someDayOfMonth} %>
        <% end %>
      </tr>
    </thead>
    <tbody>
      <% # Iterate over all users:
         workloadData.keys.each do |user| %>
         <%= render :partial => 'workload_for_user',
                    :locals => { :user => user,
                                 :data => workloadData[user],
                                 :totalWorkload => totalWorkloadPerUser[user]
                               }
         %>
      <% end %>
    </tbody>
  </table>
</div>


<div class="legend">
	<span class="hours_graph" title="leyenda"><%= l(:workload_show_legend) %></span>
	<div class="timing_graph">
		<span class="title"><strong><%= l(:workload_show_legend_title) %>:</strong></span>
		<span class="perfect" title="leyenda"><%= l(:workload_show_legend_perfect) %></span>
		<span class="normal" title="leyenda"><%=  l(:workload_show_legend_normal)  %></span>
		<span class="retard" title="leyenda"><%=  l(:workload_show_legend_retard)  %></span>
		<span class="retard2" title="leyenda"><%= l(:workload_show_legend_retard2) %></span>
		<span class="no_time" title="leyenda"><%= l(:workload_show_legend_no_time) %></span>
		<span class="father" title="leyenda"><%=  l(:workload_show_legend_father)  %></span>
	</div>
	<span class="blue"><%=  l(:workload_show_legend_time_spent) %></span>
	<span class="gray"><%=  l(:workload_show_legend_past)       %></span>
	<span class="black"><%= l(:workload_show_legend_out)        %></span>
</div>
<div style="clear:both;"></div><%

content_for :sidebar do
	render :partial => 'issues/sidebar'
end

html_title('WorkLoad') %>

